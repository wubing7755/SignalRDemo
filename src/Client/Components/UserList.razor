@using SignalRDemo.Client.Services
@using SignalRDemo.Shared.Models
@inject ChatService ChatService
@inject IJSRuntime JSRuntime

<div class="user-list-container">
    <div class="user-list-header">
        <div class="header-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>åœ¨çº¿ç”¨æˆ·</span>
            <span class="user-count">@Users.Count</span>
        </div>
    </div>

    <div class="user-list">
        @if (!Users.Any())
        {
            <div class="empty-users">
                <span class="empty-icon">ðŸ‘¥</span>
                <p>æš‚æ— åœ¨çº¿ç”¨æˆ·</p>
            </div>
        }
        else
        {
            @foreach (var user in Users)
            {
                <div class="user-item @(user == ChatService.CurrentUser ? "current-user" : "")"
                     @onclick="() => OnUserClick.InvokeAsync(user)"
                     title="ç‚¹å‡»ç§èŠ @user">
                    <div class="user-avatar" style="background: @GetUserColor(user)">
                        @GetUserInitial(user)
                    </div>
                    <div class="user-info">
                        <span class="user-name">
                            @user
                            @if (user == ChatService.CurrentUser)
                            {
                                <span class="you-badge">(æˆ‘)</span>
                            }
                        </span>
                        <span class="user-status">
                            <span class="status-dot online"></span>
                            åœ¨çº¿
                        </span>
                    </div>
                    @if (user != ChatService.CurrentUser)
                    {
                        <button class="private-chat-btn" title="å‘èµ·ç§èŠ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                        </button>
                    }
                </div>
            }
        }
    </div>
</div>

@code {
    [Parameter]
    public List<string> Users { get; set; } = new();

    [Parameter]
    public EventCallback<string> OnUserClick { get; set; }

    // é¢„å®šä¹‰çš„ç”¨æˆ·é¢œè‰²
    private static readonly string[] UserColors = new[]
    {
        "#667eea", "#764ba2", "#f093fb", "#f5576c",
        "#4facfe", "#00f2fe", "#43e97b", "#38f9d7",
        "#fa709a", "#fee140", "#30cfd0", "#330867",
        "#a8edea", "#fed6e3", "#ff9a9e", "#fecfef"
    };

    private string GetUserInitial(string userName)
    {
        if (string.IsNullOrEmpty(userName))
            return "?";

        var firstChar = userName.Trim().FirstOrDefault();
        return char.ToUpper(firstChar).ToString();
    }

    private string GetUserColor(string userName)
    {
        if (string.IsNullOrEmpty(userName))
            return UserColors[0];

        var hash = userName.GetHashCode();
        var index = Math.Abs(hash) % UserColors.Length;
        return UserColors[index];
    }
}
